

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Module standardize &mdash; npfc 0.5.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Module duplicate" href="duplicate.html" />
    <link rel="prev" title="Module filter" href="filter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> npfc
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="utils.html">Module utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="load.html">Module load</a></li>
<li class="toctree-l1"><a class="reference internal" href="save.html">Module save</a></li>
<li class="toctree-l1"><a class="reference internal" href="filter.html">Module filter</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Module standardize</a></li>
<li class="toctree-l1"><a class="reference internal" href="duplicate.html">Module duplicate</a></li>
<li class="toctree-l1"><a class="reference internal" href="fragment.html">Module fragment</a></li>
<li class="toctree-l1"><a class="reference internal" href="draw.html">Module draw</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">npfc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Module standardize</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/standardize.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="module-npfc.standardize"></span><div class="section" id="module-standardize">
<h1>Module standardize<a class="headerlink" href="#module-standardize" title="Permalink to this headline">¶</a></h1>
<p>This modules is used to standardize molecules and molecular DataFrames.</p>
<dl class="class">
<dt id="npfc.standardize.FullUncharger">
<em class="property">class </em><code class="sig-prename descclassname">npfc.standardize.</code><code class="sig-name descname">FullUncharger</code><a class="reference internal" href="_modules/npfc/standardize.html#FullUncharger"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#npfc.standardize.FullUncharger" title="Permalink to this definition">¶</a></dt>
<dd><p>A class derived from rdkit.Chem.MolStandardize.charge.Uncharger, so
instead of attempting to create zwitterions all possible charges are removed
from the molecule.</p>
<p>For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Uncharger:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">O</span><span class="o">-</span><span class="p">][</span><span class="n">N</span><span class="o">+</span><span class="p">](</span><span class="n">C</span><span class="p">)(</span><span class="n">C</span><span class="p">)</span><span class="n">C</span><span class="p">[</span><span class="n">O</span><span class="o">-</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">O</span><span class="o">-</span><span class="p">][</span><span class="n">N</span><span class="o">+</span><span class="p">](</span><span class="n">C</span><span class="p">)(</span><span class="n">C</span><span class="p">)</span><span class="n">CO</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># FullUncharger:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">O</span><span class="o">-</span><span class="p">][</span><span class="n">N</span><span class="o">+</span><span class="p">](</span><span class="n">C</span><span class="p">)(</span><span class="n">C</span><span class="p">)</span><span class="n">C</span><span class="p">[</span><span class="n">O</span><span class="o">-</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">O</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="p">](</span><span class="n">C</span><span class="p">)(</span><span class="n">C</span><span class="p">)</span><span class="n">CO</span>
</pre></div>
</div>
<p>Create an instance of FullUncharger.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>This will remove charges from -2 to +2 only. This could be improved using more general smarts?</p>
</div>
<dl class="method">
<dt id="npfc.standardize.FullUncharger.full_uncharge">
<code class="sig-name descname">full_uncharge</code><span class="sig-paren">(</span><em class="sig-param">mol</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/npfc/standardize.html#FullUncharger.full_uncharge"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#npfc.standardize.FullUncharger.full_uncharge" title="Permalink to this definition">¶</a></dt>
<dd><p>Neutralize molecule by adding/removing hydrogens.
Does not attempt to preserve zwitterions.
For now takes into account only charges of -2 and +2.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mol</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Mol</span></code>) – the input molecule</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Mol</span></code></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the uncharged molecule</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="npfc.standardize.Standardizer">
<em class="property">class </em><code class="sig-prename descclassname">npfc.standardize.</code><code class="sig-name descname">Standardizer</code><span class="sig-paren">(</span><em class="sig-param">protocol=None</em>, <em class="sig-param">col_mol='mol'</em>, <em class="sig-param">col_id='idm'</em>, <em class="sig-param">filter_duplicates=True</em>, <em class="sig-param">compute_2D=False</em>, <em class="sig-param">ref_file=None</em>, <em class="sig-param">on='inchikey'</em>, <em class="sig-param">suffix=None</em>, <em class="sig-param">elements_medchem={'B'</em>, <em class="sig-param">'Br'</em>, <em class="sig-param">'C'</em>, <em class="sig-param">'Cl'</em>, <em class="sig-param">'F'</em>, <em class="sig-param">'H'</em>, <em class="sig-param">'I'</em>, <em class="sig-param">'N'</em>, <em class="sig-param">'O'</em>, <em class="sig-param">'P'</em>, <em class="sig-param">'S'}</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/npfc/standardize.html#Standardizer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#npfc.standardize.Standardizer" title="Permalink to this definition">¶</a></dt>
<dd><p>A class for standardizing molecular structures. The standardization itself is based
on a protocol that the user can modify.</p>
<p>By default this protocol consists in 12 tasks applied to each molecule invidually:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>initiate_mol</strong>: check if the molecule passed the RDKit conversion</p></li>
<li><p><strong>filter_empty</strong>: filter molecules with empty structures</p></li>
<li><p><strong>disconnect_metal</strong>: break bonds involving metallic atoms, resulting in potentially several molecules per structure.</p></li>
<li><p><strong>keep_best</strong>: retrieve only the “best” molecule from a mixture, which might not always be the largest one.</p></li>
<li><p><strong>filter_hac</strong>: filter molecules with a heavy atom count not in the accepted range. By default: hac &gt; 3.</p></li>
<li><p><strong>filter_molweight</strong>: filter molecules with a molecular weight not in the accepted range. By default: molweight &lt;= 1000.0.</p></li>
<li><p><strong>filter_nrings</strong>: filter molecules with a number of rings (Smallest Sets of Smallest Rings or SSSR) not in the accepted range. By default: nrings &gt; 0.</p></li>
<li><p><strong>filter_medchem</strong>: filter molecules with elements not considered as medchem. By default: elements in H, B, C, N, O, F, P, S, Cl, Br, I.</p></li>
<li><p><strong>remove_isotopes</strong>: set all atoms to their most common isotope (i.e. 14C becomes 12C which is C).</p></li>
<li><p><strong>normalize</strong>: always write the same functional groups in the same manner.</p></li>
<li><p><strong>uncharge</strong>: remove all charges on a molecule when it is possible. This is different from rdkit.Chem.MolStandardize.charge module as there is no attempt for reaching the zwitterion.</p></li>
<li><p><strong>canonicalize</strong>: enumerate the canonical tautomer.</p></li>
<li><p><strong>remove_stereo</strong>: remove all remaining stereochemistry flags on the molecule.</p></li>
</ol>
</div></blockquote>
<p>Finally, duplicate entries can be filtered using InChiKeys when postprocessing the DataFrame with molecules (argument in the run_df method).</p>
<p>This results in new columns in the input DataFrame:</p>
<blockquote>
<div><ul class="simple">
<li><p>the ‘mol’ column: updated structure (only for the protocol)</p></li>
<li><p>the ‘status’ column: either passed, filtered or error.</p></li>
<li><p>the ‘task’ column: the latest task that was applied to the molecule.</p></li>
</ul>
</div></blockquote>
<p>Optionally, it is possible to compute new 2D coordinates for depicting molecules as final step of the standardization.
To achieve this, a scoring function is assigned to each depiction to retrieve the “best” one (least amount of overlapping atoms/bonds):</p>
<blockquote>
<div><ul class="simple">
<li><p>Input (if any)</p></li>
<li><p>rdDepictor</p></li>
<li><p>Avalon</p></li>
<li><p>rdCoordgen</p></li>
</ul>
</div></blockquote>
<p>A column “depiction_method” is appended to the output DataFrame so the user knows which method was considered the best.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For now, the user can only change the task order and the values of filters, but it would be relatively easy to add more functionality.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For now structures are deglycosylated before being standardized using a KIME workflow. This is far from being ideal, at the node itself contains bugs and its execution is relatively slow.</p>
</div>
<p>Create a Standardizer object.</p>
<dl class="method">
<dt id="npfc.standardize.Standardizer.keep_best">
<code class="sig-name descname">keep_best</code><span class="sig-paren">(</span><em class="sig-param">mol</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/npfc/standardize.html#Standardizer.keep_best"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#npfc.standardize.Standardizer.keep_best" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the “best” molecule found in a molecular structure.</p>
<p>The “best” molecule is determined by the following criteria, sorted by priority:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>contains only medchem elements</p></li>
<li><p>contains at least one ring</p></li>
<li><p>has the largest molecular weight of the mixture</p></li>
</ol>
</div></blockquote>
<p>To summarize:</p>
<div class="math">
<p><img src="_images/math/9d38d8a859040db59e88fdcf7b67665576b35bac.png" alt="medchem &gt; non linear &gt; molecular weight"/></p>
</div><p>So the largest molecule of a mixture might not always be selected, for instance
a very long aliphatic chain would be dismissed to keep a benzene molecule instead.</p>
<p>This is implemented in such a way because our fragments used for substructure search contain at least one ring.
On the contrary, this long aliphatic chain would be kept in a mixture with a non-medchem molecule.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mol</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Mol</span></code>) – the input molecule(s)</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Mol</span></code></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the best molecule</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="npfc.standardize.Standardizer.remove_isotopes">
<code class="sig-name descname">remove_isotopes</code><span class="sig-paren">(</span><em class="sig-param">mol</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/npfc/standardize.html#Standardizer.remove_isotopes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#npfc.standardize.Standardizer.remove_isotopes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a molecule without any isotopes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mol</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Mol</span></code>) – the input molecule</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Mol</span></code></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>the molecule without isotope</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="npfc.standardize.Standardizer.run">
<code class="sig-name descname">run</code><span class="sig-paren">(</span><em class="sig-param">mol</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/npfc/standardize.html#Standardizer.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#npfc.standardize.Standardizer.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute the standardization protocol on a molecule.
Molecule that exceed the timeout value are filtered with a task=’timeout’.</p>
<p>As a final step of the protocol, InChiKeys (‘inchikey’) are computed for identifying molecules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mol</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Mol</span></code>) – the input molecule</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a tuple containing the molecule, its status and the further task name it reached</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="npfc.standardize.Standardizer.run_df">
<code class="sig-name descname">run_df</code><span class="sig-paren">(</span><em class="sig-param">df</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/npfc/standardize.html#Standardizer.run_df"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#npfc.standardize.Standardizer.run_df" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the standardization protocol on a DataFrame, with the possibility of directly filtering duplicate entries as well.
This can be very useful as the standardization process can expose duplicate entries due to salts removal, neutralization,
canonical tautomer enumeration, and stereochemistry centers unlabelling</p>
<p>If a reference file is specified, duplicate removals becomes possible accross chunks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>df</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>) – the input DataFrame</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>three DataFrames separated by status:</p>
<ul class="simple">
<li><p>passed</p></li>
<li><p>filtered</p></li>
<li><p>error</p></li>
</ul>
</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a side effect, the output DataFrames get indexed by idm. The ‘inchikey’ col is not returned, but the values can be accessed using the reference file.</p>
</div>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="duplicate.html" class="btn btn-neutral float-right" title="Module duplicate" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filter.html" class="btn btn-neutral float-left" title="Module filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Dr. Jose-Manuel Gally

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>